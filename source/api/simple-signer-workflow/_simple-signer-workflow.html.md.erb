# **Simple signer workflow API**

## Simple signer workflow introduction

> Following examples will use **authorization as query parameter**.

In order to use requests from this documentation, it is necessary to configure an environment defined with parameters such as gateway host and authorization key.

Here's an example of API structure for an endpoint:

**HTTP Request**

`GET {{GATEWAYHOST}}/v/1/signature/workflow/pdf/simple`

In order to test requests in a test environment, you can find demonstrational gateway host in the table below. The required authorization key must be requested from Vizibit company. Once given, the authorization key should be written in a header with or without **Bearer** key word or as a **query** parameter (authorization_key) in the testing request.

**Query Parameters**

Parameter | Value
--------- | -----------
**GATEWAYHOST** | https://test.signumid.hr
**authorization_key** | Your authorization key. Add in a header of request or as **query** parameter.


### Simple signature workflow
`POST {{GATEWAYHOST}}/v/1/signature/workflow/pdf/simple`

> JSON body request example (content-type: application/json):

```json
{
  "Document": "{{PDF file for signature [base64]}}",
  "OnSignedCallback": "{{Signed document callback url}}",
  "OnErrorCallback": "{{Signing error callback url}}"
  "ExpiresAt": "{{Unix UTC timestamp for expiry}}"
}
```

Simple signature workflow integration enables 3rd party systems to easily integrate digital signature in their application, with minimal changes to the their existing codebase.

This integration is targeted for existing systems that already have an UI, and want to add the digital signature support.

The integration consist of two main components: **"Signature workflow API"** and the **"Simple signer JS SDK"**

- **Signature workflow API** - Exposes an API endpoint that receives the document for signature and two callbacks (OnSignedCallback and OnErrorCallback)
- **Simple signer JS SDK** - Javascript library that handles the PDF viewing, and the user input required to complete the remote signature

The application can be used in a **cloud environment** or a **on-premise** installation.

####StorageId and SignatureToken
> If successful the above command returns JSON structured like this (content-type: application/json):

```json
{
  "StorageId": "{{Vizibit system generated storage id}}",
  "SignatureToken": "{{Vizibit system generated signature token}}",
}

```
"StorageId" and "SignatureToken" are **Vizibit generated ids** that are **solely used by Vizibit**.

Your application only needs to communicate the described fields to the "Simple signer JS SDK" constructor.

####Diagram
As seen in the diagram below, the integration flow is as follows:

1. Your frontend UI application request a PDF document signature from your backend
2. Your backend prepares the PDF document, and defines the **OnSignedCallback and OnErrorCallback** callbacks.
After everything is prepared your backend sends a **HTTP POST** request to "**Signature workflow API**" `{{GATEWAYHOST}}/v/1/signature/workflow/pdf/simple`, and if everything is correct the API responds with a object that contains a "**StorageId**" and "**SignatureToken**"
3. Your backend communicates the "**StorageId**" and "**SignatureToken**" to your frontend UI application
4. Your frontend UI constructs the "**Simple signer JS SDK**" with the received "**StorageId**" and "**SignatureToken**"
5. The "**Simple signer JS SDK**" guides the user journey, offering him to add a signature image, to perform a user identification (e.g. video, autoident) if he doesn't have an account and perform the communication with our "**Simple Signer API**"
6. When the signature is successful or failed, the "**Simple Signer API**" notifies the "**Signature workflow API**" about the signature status
7. The "**Signature workflow API**" executes the correct callback to **notify your backend** about the signature status


![Simple Signer Workflow api](images/simple_signer_workflow_diagram.png)

###Signature workflow API
The API consists of 3 required fields: "**Document**", "**OnSignedCallback**", "**OnErrorCallback**".

- **Document** - PDF document for signature in **base64** encoding (**with padding**)
- **OnSignedCallback** -The "Signature workflow API" will call this url with HTTP POST, this will be called when the signature is **successful**.
- **OnErrorCallback** - The "Signature workflow API" will call this url with HTTP POST, this will be called when the signature is **not successful**.

Additionally the API exposes an additional optional field: "**ExpiresAt**".

- **ExpiresAt**  - ExpiresAt determines until when the document is available for signature, default value is 2 days from submission. After the period expires and the document is not signed the document is automatically deleted from the API

####Callbacks
> Callback response "OnSignedCallback"

```http
POST {{OnSignedCallback}} HTTP/1.1
Content-Type: application/pdf

{{BINARY data containing the signed PDF document}}
```

> Callback response "OnErrorCallback"

```http
POST {{OnErrorCallback}} HTTP/1.1
Content-Type: application/json

{
  "Type": "Error",
  "Description": "{{Error description}}",
  "Code": "{{ErrorCode}}"
}

```
**Callbacks** are URLs that point to your backend system, and allow us to **asynchronously** return the status of the signing operation.

You can attach an additional query parameter to callback urls so you can identify for which signature you received the response. You can choose any number of query parameters, and there are no reserved query parameters from our side for the callback urls

**For example a sample callback:**

- https://test.signumid.hr/callback?document_id=**{your_internal_document_id}**&authorization_token=**{your_authorization_token}**

The callback bodies are defined in the right column, as for the error codes the actual codes can be found at the end of this document.

Additional authentication protocols can be supported **on a on premise** installation.

---

## Simple signer workflow error feedback

All errors return the HTTP status code 400, unless an unforeseen situation has occurred. In that case HTTP status code is 500.

All errors are returned as **JSON**.

List of possible errors on Simple signer workflow interface

Error Code | Meaning
---------- | -------
30001 | Unable to create the requested workflow. Internal error
30002 | Unable to map the request to the internal object (Check for syntax errors)
30003 | Signature has been rejected by the signer
30004 | Signature has expired
30005 | Request body must be present
30006 | Request 'OnErrorCallback' must be defined
30007 | Request 'OnSignedCallback' must be defined
30008 | Request 'Document' must be defined
30009 | 'ExpiresAt' parameter is not valid (Most likely the timestamp has already expired)

In case of an error, the processing is interrupted and the error response is returned to the caller.

## Simple signer PDF signature type

**Cloud version**

- The APISs only produce **LTA** signatures
- **SHA256** is used as the hashing algorithm


**on-premise version**

- Supported signature levels: **B, T, LT, LTA**
- **SHA256** is used as the hashing algorithm (can be changed depending on the clients needs, **SHA1 is not supported**)

## Simple signer workflow security

- Every file uploaded to any of our APIs is encrypted using an **AES256** encryption (**at rest**)
- The encryption can be upgraded depending the clients wishes (applies to the on-premise installation)
- When using the cloud version of the API the keys are stored in the **Azure Key vault**, with the on-premise installation the key can be secured using the clients available security practices
- All our APIs are secured using a valid SSL certificate
- The client is responsible for adequate care of the supplied JWT token
- Data required for the signature purposes is never transmitted in plaintext, and the operation data is stored for audit trail purposes and the data processing can be seen in our Privacy policy

# **Simple signer JS SDK**
## Simple signer JS SDK introduction
TODO: add description
## Simple signer JS SDK interface
###Interfaces
TODO: List all interfaces
###Types
TODO: list all object types
